软件安装最佳实践
================

:本节贡献者: `姚家园 <https://github.com/core-man>`__ （作者）、`田冬冬 <https://me.seisman.info>`__ （作者）
:最近更新日期: 2021-01-12
:预计阅读时间: X 分钟

软件安装方式
------------

Linux 或 macOS 系统下安装软件通常有如下几种方式：

1. 使用系统自带的应用商店（App Store）在图形界面下安装软件
2. 使用软件包管理器（如 Ubuntu/Debian 的 ``apt``、Fedora 的 ``dnf``，
   或 macOS 的 ``brew``）通过命令行安装官方源提供的软件
3. 使用软件包管理器通过命令行安装第三方源提供的软件
4. 直接下载闭源软件或商业软件提供的二进制包（如 Linux 下的 deb 和 rpm，macOS 下的 dmg）
   进行安装
5. 某个编程语言的包，通常可以使用该编程语言自带的包管理工具进行安装，比如
   Python 编程语言的包管理器 ``conda`` 和 ``pip``
6. 某些软件提供了二进制的压缩包，直接解压放在某个目录，然后修改环境变量
   **PATH** 即可使用
7. 下载软件源码、编译并安装

绝大多数非科研类开源软件都可以通过方式 1—3 安装；多数商业软件
都可以通过方式 1—4 和方式 6 安装；而对于地震学科研软件而言，
则可以通过方式 5（很多地震学软件是用 Python 语言写的，因而可以通过 ``conda``
或 ``pip`` 安装）、方式 6 或方式 7 进行安装。

方式 1—5 会将软件安装到默认的位置，通常用户无法控制也无需关心其具体安装位置。
而对于方式 6 和 7，用户可选择将软件安装到任意位置。为了便于安装与管理科研
相关软件，我们总结了如下最佳实践。

软件安装路径
------------

软件安装相关的路径如下：

- :file:`~/software/`
- :file:`~/opt/`
- :file:`~/src/`
- :file:`~/bin/`
- :file:`/opt/`

软件包
^^^^^^^

软件的原始压缩包可以保存在 :file:`~/software/` 的子目录下, 相当于做一个备份，
如 :file:`~/software/TauP-2.4.5.tgz`\ 。

解压即用的软件
^^^^^^^^^^^^^^

某些软件提供了二进制包，可以解压即用，可安装在 :file:`~/opt/` 的子目录下，
如 :file:`~/opt/TauP`\ 。

从源码编译的软件
^^^^^^^^^^^^^^^^

需要从源码编译的软件，可将源码目录放在 :file:`~/src/` 的子目录下，如 :file:`~/src/fk`\ 、
:file:`~/src/GMT`\ 、:file:`~/src/distaz`\ 。

若该软件不需安装，则编译链接后生成的可执行文件在该软件目录下或其子目录 :file:`bin` 下，
如 :file:`~/src/fk`\ 、:file:`~/src/CPS/bin`\ 。如果该软件只是一个简单的小工具，
比如单个源码文件或单个可执行文件，则可以将生成的可执行文件复制至 :file:`~/bin/` 目录下，
如 :file:`~/bin/distaz`\ 。

若该软件编译后需要安装，可安装在 :file:`~/opt/` 的子目录下，如 :file:`~/opt/GMT`\ 。

闭源或商业软件
^^^^^^^^^^^^^^

大多数闭源软件或商业软件可安装到 :file:`/opt/` 的子目录下，如 Matlab、Intel 编译器等。
一般这也是闭源软件或商业软件的默认安装路径。某些与地震学科研无关的软件，比如
文献管理软件 Mendeley 和 Zotero 均可安装到任意路径，也可以安装到 :file:`/opt/` 目录下。

关于 ~/opt/ 的说明
------------------

这里推荐将科研相关软件安装到 :file:`~/opt/` 目录下，而不是更常见的 :file:`/opt/`
或 :file:`/usr/local/` 目录，主要是基于如下几点考虑：

-   某些包管理器使用了这些目录，比如 macOS 下的 Homebrew 的软件安装路径是 :file:`/usr/local`\ ，
    macOS 的 MacPorts 的软件安装路径是 :file:`/opt/local`
-   某些闭源或商业软件（如 Matlab、Google Chrome、Google Earth）默认将软件安装到
    :file:`/opt/` 目录下
-   地震学科研软件与其他软件属于不同的两类软件，因而将二者放在不同的目录下更合理
-   对于使用服务器的用户而言，通常没有权限在 :file:`/opt/` 或 :file:`/usr/local/` 等
    目录安装软件，因而服务器用户必须在家目录下安装软件。设定软件安装在 :file:`~/opt/`
    下使得用户在个人电脑和服务器上可以有完全相同的目录结构
-   将所有科研相关软件的源码及二进制文件都放在家目录下，使得备份和还原变得更简单

基于以上理由，我们推荐将地震学科研软件安装在 :file:`~/opt/` 目录下。
